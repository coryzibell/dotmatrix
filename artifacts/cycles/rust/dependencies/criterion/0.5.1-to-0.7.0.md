# criterion: 0.5.1 → 0.7.0

**Released:** 0.7.0 on July 25, 2025
**Type:** MAJOR (Breaking)
**Risk:** LOW (dev dependency)
**Edition:** 2021

## Summary

Major version jump with minimal breaking changes. Primary impact is MSRV bump and `real_blackbox` feature removal.

## Breaking Changes

### 1. MSRV Bumped to 1.80

**0.5.x:** Rust 1.64+
**0.6.0+:** Rust 1.80+

**Impact:** Must use Rust 1.80 or later.

**base-d status:** Currently on Rust 1.91.1 ✅

### 2. `real_blackbox` Feature Removed

The `real_blackbox` feature no longer exists. Criterion always uses `std::hint::black_box()`.

**Migration:**
```rust
// Old (0.5)
criterion::black_box(value)

// New (0.6+)
std::hint::black_box(value)
```

**Impact:** If you used the `real_blackbox` feature flag in Cargo.toml, remove it.

### 3. `clap` Dependency Unpinned

Less restrictive version requirements for the `clap` dependency.

**Impact:** May pull in newer clap versions. Generally benign.

## New Features

### Async Benchmarking Enhanced (0.6.0)

Support for `tokio::runtime::Handle` in addition to `tokio::runtime::Runtime`.

```rust
// Now supported
let handle = tokio::runtime::Handle::current();
c.bench_function("async_bench", |b| {
    b.to_async(&handle).iter(|| async { /* ... */ });
});
```

### Gnuplot Detection Fix (0.6.0)

Improved Gnuplot version detection for Windows binaries that previously failed.

## Version 0.7.0 Changes

Minor alignment of `criterion-plot` dependencies. No additional breaking changes.

## Migration Checklist

- [ ] Verify Rust 1.80+ (already on 1.91.1)
- [ ] Remove `real_blackbox` feature flag if used
- [ ] Replace `criterion::black_box()` with `std::hint::black_box()`
- [ ] Update version to 0.7.0
- [ ] Run benchmarks to verify

## base-d Usage

base-d uses criterion for benchmarking (dev dependency).

**Expected Changes:**
- Check for `criterion::black_box()` usage
- Update to `std::hint::black_box()` if needed

**Action:** Update to 0.7.0, check benchmark code for black_box usage.

## References

- [criterion.rs CHANGELOG](https://github.com/bheisler/criterion.rs/blob/master/CHANGELOG.md)
- [Releases](https://github.com/bheisler/criterion.rs/releases)
- [criterion on crates.io](https://crates.io/crates/criterion)

---
**Cached:** 2025-11-29
**Sources:** [GitHub criterion.rs](https://github.com/bheisler/criterion.rs/blob/master/CHANGELOG.md)
